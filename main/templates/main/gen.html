{% extends "base.html" %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static "deps/css/my_footer_css.css" %}">
<style>
    .image-container {
        background-color: #e0e0e0;
        width: 100%;
        height: 600px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0 auto;
        margin-top: 20px;
    }
    .generated-image {
        max-width: 100%;
        max-height: 100%;
    }
</style>
{% endblock %}

{% block modal_cart %}
{% include "includes/cart_button.html" %}
{% endblock modal_cart %}

{% block content %}
    <form class="row" id="generate-form">
        <div class="col">
            <textarea class="form-control ms-5 mt-4" id="description" rows="3" placeholder="Введите описание букета..."></textarea>
        </div>
        <div class="col-3">
            <button type="button" class="btn btn-success ms-5 mt-4" onclick="generateBouquet()">Сгенерировать букет</button>
        </div>
    </form>
    <div class="image-container">
        <img id="generated-image" src="" class="generated-image">
    </div>
{% endblock %}

{% block footer %}
    <footer class="py-4 bg-success-subtle">
        <div class="container">
            <p class="m-0 text-center text-success">Покшубина Софья, ВКБР 2024</p>
        </div>
    </footer>
{% endblock %}

{% block js %}
<script>
    let generatedImageData = '';

    function generateBouquet() {
        const description = document.getElementById('description').value;
        fetch("{% url 'main:generate_image' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ 'prompt': description })
        })
        .then(response => response.json())
        .then(data => {
            generatedImageData = data.image_data;
            document.getElementById('generated-image').src = 'data:image/png;base64,' + data.image_data;
        })
        .catch(error => console.error('Error:', error));
    }
</script>
{% endblock %}
